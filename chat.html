<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grok AI Chat</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="https://apis.google.com/js/api.js"></script>
    <style>
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .typing-indicator {
            display: flex;
            padding: 8px 12px;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            margin: 0 2px;
            background-color: #4b5563;
            border-radius: 50%;
            animation: pulse 1.5s infinite ease-in-out;
        }

        .typing-dot:nth-child(1) { animation-delay: 0s; }
        .typing-dot:nth-child(2) { animation-delay: 0.3s; }
        .typing-dot:nth-child(3) { animation-delay: 0.6s; }

        .chat-container {
            height: calc(100vh - 160px);
        }

        .message-animation {
            animation: messageAppear 0.3s ease-out;
        }

        @keyframes messageAppear {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .xai-explanation {
            border-left: 3px solid #6366f1;
            transition: all 0.3s ease;
        }

        .xai-explanation:hover {
            background-color: #f8fafc;
        }

        .dark .xai-explanation:hover {
            background-color: #1e293b;
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 transition-colors duration-200">
<div class="container mx-auto max-w-6xl px-4 py-6">
    <!-- Login Section (shown when not authenticated) -->
    <div id="login-section" class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-8 max-w-md mx-auto my-12 text-center">
        <h2 class="text-2xl font-bold mb-6">Welcome to Grok AI Assistant</h2>
        <div id="g_id_onload"
             data-client_id="YOUR_GOOGLE_CLIENT_ID.apps.googleusercontent.com"
             data-context="signin"
             data-ux_mode="popup"
             data-callback="handleGoogleSignIn"
             data-auto_prompt="false">
        </div>
        <div class="g_id_signin"
             data-type="standard"
             data-shape="pill"
             data-theme="outline"
             data-text="signin_with"
             data-size="large"
             data-logo_alignment="left"
             data-width="300">
        </div>
        <div class="mt-6 text-sm text-gray-500 dark:text-gray-400">
            <p>By signing in, you agree to our Terms of Service and Privacy Policy</p>
        </div>
        <button id="try-without-login" class="mt-4 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 px-4 py-2 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition">
            Try Without Login
        </button>
    </div>

    <!-- Main App (hidden until authenticated) -->
    <div id="app-content" class="hidden">
        <!-- Header -->
        <header class="flex justify-between items-center mb-6">
            <div class="flex items-center space-x-2">
                <div class="w-10 h-10 rounded-full bg-gradient-to-r from-purple-600 to-blue-500 flex items-center justify-center text-white font-bold text-xl">N</div>
                <h1 class="text-2xl font-bold">NEURONEXIS</h1>
            </div>
            <div class="flex items-center space-x-4">
                <button id="theme-toggle" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700">
                    <i class="fas fa-moon dark:hidden"></i>
                    <i class="fas fa-sun hidden dark:block"></i>
                </button>
                <button class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700">
                    <i class="fas fa-cog"></i>
                </button>
            </div>
        </header>

        <!-- Main Chat Area -->
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg overflow-hidden">
            <!-- Chat Header -->
            <div class="border-b border-gray-200 dark:border-gray-700 p-4 flex justify-between items-center">
                <div class="flex items-center space-x-3">
                    <div class="w-8 h-8 rounded-full bg-gradient-to-r from-purple-500 to-blue-400"></div>
                    <h2 class="font-semibold">Grok Chat</h2>
                </div>
                <div class="flex space-x-2">
                    <button class="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700">
                        <i class="fas fa-ellipsis-h"></i>
                    </button>
                </div>
            </div>

            <!-- Messages Container -->
            <div class="chat-container overflow-y-auto p-4 space-y-4" id="chat-messages">
                <!-- Welcome Message -->
                <div class="flex justify-start">
                    <div class="max-w-[80%] bg-gray-100 dark:bg-gray-700 rounded-xl p-4 message-animation">
                        <div class="flex items-start space-x-2">
                            <div class="w-6 h-6 rounded-full bg-gradient-to-r from-purple-500 to-blue-400 mt-1"></div>
                            <div>
                                <p class="font-semibold">Grok AI</p>
                                <p class="text-sm text-gray-500 dark:text-gray-400">Hey there! I'm Grok, your AI assistant. I can explain my reasoning as we chat - just ask me "why" or "how" about any response!</p>
                                <div class="mt-2 text-sm text-gray-500 dark:text-gray-400">
                                    <p><i class="fas fa-lightbulb mr-1 text-yellow-500"></i> Try asking me something like "Explain how you work" or "Why did you say that?"</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tier Selection and Features -->
            <div class="border-t border-gray-200 dark:border-gray-700 p-4">
                <div class="mb-4">
                    <h3 class="font-semibold mb-2">Select Your Plan:</h3>
                    <div class="grid grid-cols-4 gap-2">
                        <button class="tier-btn bg-blue-100 dark:bg-blue-900 px-3 py-2 rounded-lg text-sm" data-tier="basic">Basic+</button>
                        <button class="tier-btn bg-purple-100 dark:bg-purple-900 px-3 py-2 rounded-lg text-sm" data-tier="pro">Pro+</button>
                        <button class="tier-btn bg-green-100 dark:bg-green-900 px-3 py-2 rounded-lg text-sm" data-tier="premium">Premium+</button>
                        <button class="tier-btn bg-red-100 dark:bg-red-900 px-3 py-2 rounded-lg text-sm" data-tier="family">Family+</button>
                    </div>
                </div>

                <div id="features-container" class="mb-4 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                    <h3 class="font-semibold mb-2">Active Features:</h3>
                    <div id="basic-features" class="space-y-2">
                        <div class="flex items-center">
                            <input type="checkbox" id="email-mgmt" class="mr-2" checked>
                            <label for="email-mgmt">Email Management</label>
                        </div>
                        <div class="flex items-center">
                            <input type="checkbox" id="calendar-mgmt" class="mr-2" checked>
                            <label for="calendar-mgmt">Calendar Management</label>
                        </div>
                    </div>
                    <div id="pro-features" class="space-y-2 hidden">
                        <!-- Pro features will be shown when Pro tier is selected -->
                    </div>
                    <!-- Other tier features would be added similarly -->
                </div>

                <!-- Input Area -->
                <div class="border-t border-gray-200 dark:border-gray-700 p-4">
                    <div class="flex items-center space-x-2">
                        <button id="document-creation" class="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700" title="Create Document">
                            <i class="fas fa-file-word"></i>
                        </button>
                        <button id="social-lookup" class="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700" title="Find Social Profiles">
                            <i class="fas fa-user-friends"></i>
                        </button>
                        <div class="flex-grow relative">
                            <textarea id="message-input" rows="1" class="w-full border border-gray-300 dark:border-gray-600 rounded-full py-3 px-4 pr-12 focus:outline-none focus:ring-2 focus:ring-purple-500 dark:bg-gray-700 resize-none" placeholder="Message Grok..."></textarea>
                            <button id="send-button" class="absolute right-3 top-1/2 transform -translate-y-1/2 p-1 rounded-full text-gray-500 hover:text-purple-600 dark:hover:text-purple-400">
                                <i class="fas fa-paper-plane text-xl"></i>
                            </button>
                        </div>
                        <button class="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700">
                            <i class="fas fa-microphone"></i>
                        </button>
                    </div>
                    <div class="flex justify-between items-center mt-2 px-2">
                        <div class="flex space-x-1 text-xs text-gray-500 dark:text-gray-400">
                            <span>Grok may produce inaccurate information</span>
                        </div>
                        <button id="xai-toggle" class="text-xs bg-purple-100 dark:bg-purple-900 text-purple-800 dark:text-purple-200 px-2 py-1 rounded-full flex items-center space-x-1">
                            <i class="fas fa-brain"></i>
                            <span>XAI Mode: On</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Document Creation Modal -->
        <div id="document-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
            <div class="bg-white dark:bg-gray-800 rounded-lg p-6 w-full max-w-4xl max-h-[90vh] flex flex-col">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold">Document Editor</h3>
                    <button id="close-document-modal" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div id="document-content" class="flex-1 border border-gray-300 dark:border-gray-600 p-4 mb-4 overflow-y-auto"></div>
                <div class="flex space-x-2">
                    <select id="document-type" class="bg-gray-100 dark:bg-gray-700 rounded-lg px-3 py-2">
                        <option value="docx">Word Document</option>
                        <option value="pdf">PDF</option>
                        <option value="txt">Text File</option>
                    </select>
                    <button id="download-document" class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700">
                        Download
                    </button>
                </div>
            </div>
        </div>

        <script>
            // Google API configuration
            const CLIENT_ID = '906465572275-hanrq89dvi0a8bpf2benqdq7quu3njtc.apps.googleusercontent.com';
            const API_KEY = 'AIzaSyD1vYQ9j2x4J6Xh5q7v8w9z0x1y2z3a4b5c';
            const SCOPES = [
                'https://www.googleapis.com/auth/calendar',
                'https://www.googleapis.com/auth/gmail.readonly',
                'https://www.googleapis.com/auth/userinfo.profile'
            ];

            let currentUser = null;
            let currentTier = 'basic';
            let gapiInited = false;
            let gisInited = false;

            document.addEventListener('DOMContentLoaded', function() {
                // Check if we're running on GitHub Pages
                if (window.location.hostname.includes('github.io')) {
                    document.body.classList.add('github-pages');
                }

                // Google API initialization
                function gapiLoaded() {
                    gapi.load('client', initializeGapiClient);
                }

                async function initializeGapiClient() {
                    await gapi.client.init({
                        apiKey: API_KEY,
                        discoveryDocs: [
                            'https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest',
                            'https://www.googleapis.com/discovery/v1/apis/gmail/v1/rest'
                        ],
                    });
                    gapiInited = true;
                    maybeEnableApp();
                }

                function gisLoaded() {
                    gisInited = true;
                    maybeEnableApp();
                }

                function maybeEnableApp() {
                    if (gapiInited && gisInited) {
                        document.getElementById('login-section').classList.remove('hidden');
                    }
                }

                async function lookupSocialProfile(username) {
                    try {
                        // This would connect to your backend service for social profile lookup
                        const response = await fetch('/api/social-lookup', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({ username })
                        });

                        const data = await response.json();
                        return data.profile;
                    } catch (error) {
                        console.error('Profile lookup error:', error);
                        return null;
                    }
                }

                function handleGoogleSignIn(response) {
                    if (response.credential) {
                        // Decode JWT token to get user info
                        const userInfo = parseJwt(response.credential);
                        currentUser = {
                            name: userInfo.name,
                            email: userInfo.email,
                            picture: userInfo.picture
                        };

                        // Show app content
                        document.getElementById('login-section').classList.add('hidden');
                        document.getElementById('app-content').classList.remove('hidden');

                        // Load user data and initialize features
                        loadUserData();
                    }
                }

                function parseJwt(token) {
                    const base64Url = token.split('.')[1];
                    const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
                    const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
                        return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
                    }).join(''));
                    return JSON.parse(jsonPayload);
                }

                function loadUserData() {
                    // Request location access
                    if (navigator.geolocation) {
                        navigator.geolocation.getCurrentPosition(
                            position => {
                                userLocation = {
                                    lat: position.coords.latitude,
                                    lng: position.coords.longitude
                                };
                                addMessage(`I've detected you're near ${position.coords.latitude}, ${position.coords.longitude}. I can provide location-specific recommendations.`, 'ai');
                            },
                            error => {
                                addMessage('Location access denied. Some features may be limited.', 'ai');
                            }
                        );
                    }

                    // Load user's calendar and email data if logged in
                    if (currentUser) {
                        loadCalendarEvents();
                        loadEmails();

                        // Update UI with user info
                        const userAvatar = document.createElement('div');
                        userAvatar.className = 'w-8 h-8 rounded-full bg-cover bg-center';
                        userAvatar.style.backgroundImage = `url(${currentUser.picture})`;
                        document.querySelector('header').prepend(userAvatar);
                    }
                }

                // Try without login functionality
                document.getElementById('try-without-login').addEventListener('click', function() {
                    currentUser = {
                        name: 'Guest User',
                        email: 'guest@neuronexis.com',
                        picture: 'https://via.placeholder.com/150'
                    };
                    document.getElementById('login-section').classList.add('hidden');
                    document.getElementById('app-content').classList.remove('hidden');
                    loadUserData();
                });

                async function loadCalendarEvents() {
                    try {
                        const response = await gapi.client.calendar.events.list({
                            calendarId: 'primary',
                            timeMin: new Date().toISOString(),
                            showDeleted: false,
                            singleEvents: true,
                            maxResults: 10,
                            orderBy: 'startTime'
                        });
                        const events = response.result.items;
                        console.log('Upcoming events:', events);
                        // Process events and display them
                    } catch (err) {
                        console.error('Error loading calendar events:', err);
                    }
                }

                async function loadEmails() {
                    try {
                        const response = await gapi.client.gmail.users.messages.list({
                            userId: 'me',
                            maxResults: 10
                        });
                        const messages = response.result.messages;
                        console.log('Recent emails:', messages);
                        // Process emails and display them
                    } catch (err) {
                        console.error('Error loading emails:', err);
                    }
                }

                // Theme toggle
                const themeToggle = document.getElementById('theme-toggle');
                themeToggle.addEventListener('click', () => {
                    document.documentElement.classList.toggle('dark');
                    localStorage.setItem('theme', document.documentElement.classList.contains('dark') ? 'dark' : 'light');
                });

                // Check for saved theme preference
                if (localStorage.getItem('theme') === 'dark' || (!localStorage.getItem('theme') && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                    document.documentElement.classList.add('dark');
                }

                // Chat functionality
                const messageInput = document.getElementById('message-input');
                const sendButton = document.getElementById('send-button');
                const chatMessages = document.getElementById('chat-messages');
                const xaiToggle = document.getElementById('xai-toggle');
                let xaiMode = true;

                // Auto-resize textarea
                messageInput.addEventListener('input', function() {
                    this.style.height = 'auto';
                    this.style.height = (this.scrollHeight) + 'px';
                });

                // Send message on Enter (but allow Shift+Enter for new line)
                messageInput.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        sendMessage();
                    }
                });

                sendButton.addEventListener('click', sendMessage);

                // XAI mode toggle
                xaiToggle.addEventListener('click', function() {
                    xaiMode = !xaiMode;
                    this.innerHTML = xaiMode ?
                        '<i class="fas fa-brain"></i><span>XAI Mode: On</span>' :
                        '<i class="fas fa-brain"></i><span>XAI Mode: Off</span>';
                    this.classList.toggle('bg-purple-100', xaiMode);
                    this.classList.toggle('dark:bg-purple-900', xaiMode);
                    this.classList.toggle('bg-gray-200', !xaiMode);
                    this.classList.toggle('dark:bg-gray-700', !xaiMode);
                });

                function sendMessage() {
                    const message = messageInput.value.trim();
                    if (message === '') return;

                    // Add user message to chat
                    addMessage(message, 'user');
                    messageInput.value = '';
                    messageInput.style.height = 'auto';

                    // Show typing indicator
                    showTypingIndicator();

                    // Simulate AI response after a delay
                    setTimeout(() => {
                        removeTypingIndicator();
                        const aiResponse = generateAIResponse(message);
                        addMessage(aiResponse.response, 'ai');

                        // If XAI mode is on and the response has an explanation, add it
                        if (xaiMode && aiResponse.explanation) {
                            setTimeout(() => {
                                addMessage(aiResponse.explanation, 'ai', true);
                            }, 500);
                        }
                    }, 1500 + Math.random() * 2000);
                }

                function addMessage(text, sender, isExplanation = false, documentContent = null) {
                    const messageDiv = document.createElement('div');
                    messageDiv.classList.add('flex', 'message-animation');

                    if (sender === 'user') {
                        messageDiv.classList.add('justify-end');
                        messageDiv.innerHTML = `
                        <div class="max-w-[80%] bg-purple-600 text-white rounded-xl p-4">
                            <p>${text}</p>
                        </div>
                    `;
                    } else {
                        messageDiv.classList.add('justify-start');
                        if (isExplanation) {
                            messageDiv.innerHTML = `
                            <div class="max-w-[80%] bg-gray-100 dark:bg-gray-700 rounded-xl p-4 xai-explanation">
                                <div class="flex items-start space-x-2">
                                    <div class="w-6 h-6 rounded-full bg-gradient-to-r from-purple-500 to-blue-400 mt-1 flex items-center justify-center text-white text-xs">X</div>
                                    <div>
                                        <p class="font-semibold text-purple-600 dark:text-purple-400">Explanation</p>
                                        <p>${text}</p>
                                    </div>
                                </div>
                            </div>
                        `;
                        } else {
                            messageDiv.innerHTML = `
                            <div class="max-w-[80%] bg-gray-100 dark:bg-gray-700 rounded-xl p-4">
                                <div class="flex items-start space-x-2">
                                    <div class="w-6 h-6 rounded-full bg-gradient-to-r from-purple-500 to-blue-400 mt-1"></div>
                                    <div>
                                        <p class="font-semibold">Grok AI</p>
                                        <p>${text}</p>
                                    </div>
                                </div>
                            </div>
                        `;
                        }
                    }

                    chatMessages.appendChild(messageDiv);
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                }

                function showTypingIndicator() {
                    const typingDiv = document.createElement('div');
                    typingDiv.classList.add('flex', 'justify-start');
                    typingDiv.id = 'typing-indicator';
                    typingDiv.innerHTML = `
                    <div class="max-w-[80%] bg-gray-100 dark:bg-gray-700 rounded-xl p-2">
                        <div class="flex items-center space-x-2 pl-2">
                            <div class="w-6 h-6 rounded-full bg-gradient-to-r from-purple-500 to-blue-400"></div>
                            <div class="typing-indicator">
                                <div class="typing-dot"></div>
                                <div class="typing-dot"></div>
                                <div class="typing-dot"></div>
                            </div>
                        </div>
                    </div>
                `;
                    chatMessages.appendChild(typingDiv);
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                }

                function removeTypingIndicator() {
                    const typingIndicator = document.getElementById('typing-indicator');
                    if (typingIndicator) {
                        typingIndicator.remove();
                    }
                }

                async function generateAIResponse(userMessage) {
                    const lowerMessage = userMessage.toLowerCase();
                    let response = "";
                    let explanation = "";
                    let documentContent = "";

                    try {
                        // Connect to Grok API
                        const apiResponse = await fetch('https://api.x.ai/v1/chat/completions', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': 'Bearer YOUR_GROK_API_KEY'
                            },
                            body: JSON.stringify({
                                model: 'grok-1',
                                messages: [
                                    {
                                        role: 'system',
                                        content: `You are NEURONEXIS, a highly intelligent AI assistant.
                                    Current user location: ${userLocation ? `${userLocation.lat}, ${userLocation.lng}` : 'unknown'}.
                                    Provide detailed, location-aware responses. For document creation, wrap content between ===DOCUMENT=== markers.`
                                    },
                                    {role: 'user', content: userMessage}
                                ],
                                temperature: 0.7,
                                max_tokens: 4000
                            })
                        });

                        const data = await apiResponse.json();
                        const fullResponse = data.choices[0].message.content;

                        // Check for document content
                        if (fullResponse.includes('===DOCUMENT===')) {
                            const docStart = fullResponse.indexOf('===DOCUMENT===') + 14;
                            const docEnd = fullResponse.indexOf('===END_DOCUMENT===');
                            documentContent = fullResponse.substring(docStart, docEnd).trim();
                            response = fullResponse.substring(0, fullResponse.indexOf('===DOCUMENT===')).trim();
                        } else {
                            response = fullResponse;
                        }

                        // Generate explanation if in XAI mode
                        if (xaiMode) {
                            const explainResponse = await fetch('https://api.x.ai/v1/chat/completions', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                    'Authorization': 'Bearer YOUR_GROK_API_KEY'
                                },
                                body: JSON.stringify({
                                    model: 'grok-1',
                                    messages: [
                                        {
                                            role: 'system',
                                            content: 'Explain the reasoning behind this response in detail, including any location-based considerations.'
                                        },
                                        {role: 'user', content: `Original query: ${userMessage}\n\nResponse: ${response}`}
                                    ],
                                    temperature: 0.5,
                                    max_tokens: 1000
                                })
                            });

                            const explainData = await explainResponse.json();
                            explanation = explainData.choices[0].message.content;
                        }

                    } catch (error) {
                        console.error('API Error:', error);
                        response = "I'm having trouble connecting to the NEURONEXIS servers. Please try again later.";
                        explanation = "The API request failed. This could be due to network issues or server problems.";
                    }
                else if (lowerMessage.includes('how are you')) {
                        response = "I'm functioning optimally, thank you for asking! As an AI, I don't have feelings, but I'm always ready to help.";
                        explanation = "You asked about my state, so I provided information about my operational status while clarifying that I don't experience emotions like humans do.";
                    }
                    else if (lowerMessage.includes('explain') || lowerMessage.includes('how you work') || lowerMessage.includes('why did you say')) {
                        response = "I'm happy to explain!";
                        explanation = "I'm designed to process your input, analyze patterns, and generate relevant responses based on my training data. When you ask for explanations, I can provide insights into my reasoning process.";
                    }
                    else if (lowerMessage.includes('weather')) {
                        response = "I can't access real-time weather data, but I can tell you that weather patterns are influenced by atmospheric conditions, temperature, and humidity.";
                        explanation = "You mentioned 'weather', so I explained my limitations regarding real-time data while providing general information about weather patterns.";
                    }
                    else if (lowerMessage.includes('joke')) {
                        response = "Why don't scientists trust atoms? Because they make up everything!";
                        explanation = "You asked for a joke, so I selected a scientifically-themed pun from my training data that typically elicits positive engagement.";
                    }
                    else {
                        response = "I'm designed to assist with a wide range of topics. Could you clarify or ask me something more specific?";
                        explanation = "Your message didn't match my predefined response patterns, so I prompted for clarification to better understand your needs and provide more accurate assistance.";
                    }

                    // Randomly add more technical details to explanations
                    if (Math.random() > 0.5 && xaiMode) {
                        explanation += "\n\n[Technical Note: My response was generated by analyzing word patterns and selecting the most statistically likely appropriate response based on my training corpus.]";
                    }

                    return {
                        response: response,
                        explanation: explanation
                    };
                }

                // Add some sample conversation starters
                const sampleQuestions = [
                    "Explain how you generate responses",
                    "What's the weather like today?",
                    "Tell me a joke",
                    "How does XAI work?",
                    "Why did you say that?"
                ];

                // Tier selection functionality
                document.querySelectorAll('.tier-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        currentTier = this.dataset.tier;
                        updateActiveFeatures();
                    });
                });

                function updateActiveFeatures() {
                    // Hide all feature sections first
                    document.querySelectorAll('#features-container > div').forEach(section => {
                        section.classList.add('hidden');
                    });

                    // Show features based on selected tier
                    document.getElementById(`${currentTier}-features`).classList.remove('hidden');

                    // Enable/disable features based on tier
                    // This would be expanded based on your actual feature implementation
                }

                // Feature toggle functionality
                document.querySelectorAll('#features-container input[type="checkbox"]').forEach(checkbox => {
                    checkbox.addEventListener('change', function() {
                        const featureId = this.id;
                        // Implement feature enable/disable logic here
                        console.log(`Feature ${featureId} ${this.checked ? 'enabled' : 'disabled'}`);
                    });
                });

                // Add sample questions to the input placeholder on focus
                messageInput.addEventListener('focus', function() {
                    const randomQuestion = sampleQuestions[Math.floor(Math.random() * sampleQuestions.length)];
                    this.placeholder = `Try: "${randomQuestion}"`;
                });

                messageInput.addEventListener('blur', function() {
                    this.placeholder = "Message Grok...";
                });
            });
        </script>
</body>
</html>