<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>AI Productivity Dashboard - NEURONEXIS</title>
  <meta content="AI-powered productivity dashboard for tasks, reminders, and calendar management" name="description">
  <meta content="AI, productivity, dashboard, NEURONEXIS" name="keywords">

  <!-- Favicons -->
  <link href="assets/img/favicon.png" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Font Awesome for Icons -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

  <!-- Custom Tailwind Config -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#2563EB', // Vibrant blue for primary actions
            secondary: '#4B5563', // Muted gray for secondary text/icons
            accent: '#FBBF24', // Warm yellow for highlights
            success: '#16A34A', // Green for success states
            danger: '#DC2626', // Red for errors/warnings
            background: '#F3F4F6', // Light gray background
            card: '#FFFFFF', // White cards in light mode
            soft: '#DBEAFE', // Light blue for subtle backgrounds
            darkBg: '#111827', // Dark gray background in dark mode
            darkCard: '#1F2937', // Slightly lighter gray for dark mode cards
            darkText: '#D1D5DB', // Light gray text in dark mode
          },
          borderRadius: {
            'xl': '12px',
            '2xl': '16px',
          },
          animation: {
            slideIn: 'slideIn 0.3s ease-in-out',
            pulse: 'pulse 1s infinite',
          },
          keyframes: {
            slideIn: {
              '0%': { opacity: '0', transform: 'translateY(20px)' },
              '100%': { opacity: '1', transform: 'translateY(0)' },
            },
            pulse: {
              '0%': { transform: 'scale(1)', opacity: '1' },
              '100%': { transform: 'scale(2)', opacity: '0' },
            },
          },
        },
      },
    };
  </script>

  <!-- Custom Styles -->
  <style>
    [data-theme="dark"] {
      --bg-background: #111827;
      --bg-card: #1F2937;
      --text-primary: #D1D5DB;
      --text-secondary: #9CA3AF;
      --border-soft: #374151;
    }
    [data-theme="light"] {
      --bg-background: #F3F4F6;
      --bg-card: #FFFFFF;
      --text-primary: #1F2937;
      --text-secondary: #4B5563;
      --border-soft: #DBEAFE;
    }
    body {
      background-color: var(--bg-background);
      color: var(--text-primary);
    }
    .bg-card {
      background-color: var(--bg-card);
    }
    .text-primary {
      color: var(--text-primary);
    }
    .text-secondary {
      color: var(--text-secondary);
    }
    .border-soft {
      border-color: var(--border-soft);
    }
    .chat-box, .daily-overview, .tasks-reminders {
      scrollbar-width: none;
    }
    .chat-box::-webkit-scrollbar, .daily-overview::-webkit-scrollbar, .tasks-reminders::-webkit-scrollbar {
      display: none;
    }
    .message img, .overview-item img {
      max-width: 100%;
      height: auto;
      border-radius: 8px;
    }
    .chat-box {
      background: linear-gradient(145deg, var(--bg-card), var(--border-soft));
    }
    body, html {
      height: 100%;
      margin: 0;
      padding: 0;
    }
    #main {
      padding-bottom: 80px;
    }
    section {
      gap: 1rem;
    }
    @media (max-width: 1024px) {
      #pomodoro-container, #daily-overview-container, #tasks-container, #recommendations-container {
        display: none;
      }
      #pomodoro-toggle, #tasks-toggle, #recommendations-toggle {
        display: block;
      }
    }
    @media (min-width: 1024px) {
      .lg\:grid-cols-3 {
        grid-template-columns: 1fr 2fr 1fr;
      }
      #pomodoro-container, #daily-overview-container, #tasks-container, #recommendations-container {
        display: block;
      }
      #pomodoro-toggle, #tasks-toggle, #recommendations-toggle {
        display: none;
      }
    }
    @media (max-width: 640px) {
      #main {
        margin-top: 60px;
        padding-bottom: 100px;
      }
      #header {
        padding: 0.5rem 1rem;
      }
      #sidebar {
        width: 75%;
      }
      .chat-box {
        max-height: 50vh;
      }
      .daily-overview, .tasks-reminders {
        max-height: 30vh;
      }
      .text-xs {
        font-size: 0.875rem;
      }
      .p-2 {
        padding: 0.75rem;
      }
      .py-1 {
        padding-top: 0.5rem;
        padding-bottom: 0.5rem;
      }
      .px-2 {
        padding-left: 0.75rem;
        padding-right: 0.75rem;
      }
      .rounded-full {
        min-width: 44px;
        min-height: 44px;
      }
      #input-form {
        flex-direction: column;
        align-items: stretch;
      }
      #input-form > *:not(:last-child) {
        margin-bottom: 0.5rem;
      }
      #lang-select, #user-input {
        padding: 0.5rem 1rem;
        font-size: 0.875rem;
      }
      #input-form button {
        padding: 0.75rem;
        width: 100%;
        display: inline-flex;
        justify-content: center;
      }
      #pomodoro-container, #tasks-container, #recommendations-container {
        margin-top: 1rem;
      }
      .toggle-section {
        margin-bottom: 0.5rem;
      }
    }
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }
    .modal-content {
      background: var(--bg-card);
      padding: 1.5rem;
      border-radius: 12px;
      max-width: 90%;
      width: 400px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      color: var(--text-primary);
    }
    .modal-content h2 {
      font-size: 1.25rem;
      margin-bottom: 1rem;
    }
    .modal-content input, .modal-content textarea {
      width: 100%;
      padding: 0.5rem;
      margin-bottom: 1rem;
      border: 1px solid var(--border-soft);
      border-radius: 8px;
      background: var(--bg-background);
      color: var(--text-primary);
    }
    .modal-content .btn-group {
      display: flex;
      justify-content: flex-end;
      gap: 0.5rem;
    }
  </style>
</head>

<body class="font-inter min-h-screen flex flex-col" data-theme="light">
<!-- ======= Header ======= -->
<header id="header" class="fixed top-0 left-0 right-0 z-50 bg-card shadow-sm flex items-center justify-between px-2 py-2 md:px-6 md:py-3 w-full">
  <div class="flex items-center">
    <a href="index.html" class="flex items-center space-x-1">
      <img src="assets/img/logo.png" alt="NEURONEXIS" class="h-6 md:h-8">
      <span class="hidden md:block text-lg md:text-xl font-semibold text-primary" data-translate="header.title">NEURONEXIS</span>
    </a>
    <button id="toggle-sidebar-btn" class="md:hidden ml-2 text-secondary">
      <i class="fas fa-bars text-lg md:text-xl"></i>
    </button>
  </div>
  <nav class="flex items-center space-x-2">
    <div class="relative hidden md:block">
      <input type="text" id="search-input" placeholder="Search..." class="pl-8 pr-3 py-1 md:py-2 rounded-full bg-gray-100 text-sm focus:outline-none focus:ring-2 focus:ring-primary w-32 md:w-48" data-translate="header.search">
      <i class="fas fa-search absolute left-2 top-1/2 transform -translate-y-1/2 text-secondary"></i>
    </div>
    <select id="lang-select" class="bg-card border border-gray-200 rounded-lg px-1 md:px-3 py-1 md:py-2 text-xs md:text-sm focus:outline-none focus:ring-2 focus:ring-primary">
      <option value="en-US">English</option>
      <option value="ro-RO">Română</option>
      <option value="ru-RU">Русский</option>
      <option value="es-ES">Español</option>
      <option value="fr-FR">Français</option>
    </select>
    <button id="theme-toggle" class="text-secondary hover:text-primary">
      <i class="fas fa-moon text-lg md:text-xl"></i>
    </button>
    <div class="relative">
      <button class="flex items-center space-x-1" id="profile-btn" aria-label="Profile menu">
        <img id="header-profile-image" src="assets/img/profile-img.jpg" alt="Profile" class="h-6 md:h-8 w-6 md:w-8 rounded-full object-cover">
        <span id="user-name" class="hidden md:block text-sm font-medium text-secondary">Guest</span>
      </button>
      <ul class="dropdown-menu absolute right-0 mt-1 md:mt-2 w-40 md:w-48 bg-card rounded-xl shadow-lg py-1 hidden" id="profile-dropdown">
        <li class="px-3 py-1">
          <p id="user-fullname" class="font-semibold text-primary text-xs md:text-sm">Guest</p>
          <p id="user-role" class="text-xs md:text-sm text-secondary">Guest User</p>
        </li>
        <li><hr class="my-1 border-gray-200"></li>
        <li><a href="#" id="upload-image-btn" class="flex items-center px-3 py-1 text-xs md:text-sm text-secondary hover:bg-gray-100" data-translate="profile.upload_image"><i class="fas fa-image mr-1 md:mr-2"></i> Upload Image</a></li>
        <li><a href="#" class="flex items-center px-3 py-1 text-xs md:text-sm text-secondary hover:bg-gray-100" data-translate="profile.settings"><i class="fas fa-cog mr-1 md:mr-2"></i> Account Settings</a></li>
        <li><a href="#" class="flex items-center px-3 py-1 text-xs md:text-sm text-secondary hover:bg-gray-100" data-translate="profile.help"><i class="fas fa-question-circle mr-1 md:mr-2"></i> Need Help?</a></li>
        <li><hr class="my-1 border-gray-200"></li>
        <li><a href="https://accounts.google.com/o/oauth2/v2/auth?client_id=906465572275-hanrq89dvi0a8bpf2benqdq7quu3njtc.apps.googleusercontent.com&redirect_uri=http://localhost:3000/callback&response_type=code&scope=profile email https://www.googleapis.com/auth/calendar https://www.googleapis.com/auth/gmail.send&state=state_token&nonce=nonce_token" target="_blank" id="google-signin-btn" class="flex items-center px-3 py-1 text-xs md:text-sm text-secondary hover:bg-gray-100 w-full text-left" data-translate="profile.google_signin"><i class="fab fa-google mr-1 md:mr-2"></i> Sign in with Google</a></li>
        <li><button id="facebook-signin-btn" class="flex items-center px-3 py-1 text-xs md:text-sm text-secondary hover:bg-gray-100 w-full text-left" data-translate="profile.facebook_signin"><i class="fab fa-facebook mr-1 md:mr-2"></i> Sign in with Facebook</button></li>
        <li><button id="instagram-signin-btn" class="flex items-center px-3 py-1 text-xs md:text-sm text-secondary hover:bg-gray-100 w-full text-left" data-translate="profile.instagram_signin"><i class="fab fa-instagram mr-1 md:mr-2"></i> Sign in with Instagram</button></li>
        <li><a href="#" id="logout-btn" class="flex items-center px-3 py-1 text-xs md:text-sm text-danger hover:bg-gray-100" data-translate="profile.signout"><i class="fas fa-sign-out-alt mr-1 md:mr-2"></i> Sign Out</a></li>
      </ul>
    </div>
  </nav>
</header>

<!-- ======= Sidebar ======= -->
<aside id="sidebar" class="fixed top-0 left-0 w-48 md:w-64 h-full bg-card shadow-lg transform -translate-x-full md:translate-x-0 transition-transform duration-300 z-40">
  <div class="flex items-center justify-between p-2 md:p-4 border-b">
    <span class="text-lg md:text-xl font-semibold text-primary" data-translate="sidebar.menu">Menu</span>
    <button id="close-sidebar-btn" class="md:hidden text-secondary">
      <i class="fas fa-times text-lg md:text-xl"></i>
    </button>
  </div>
  <ul class="py-2 md:py-4">
    <li class="px-2 md:px-4 py-1 md:py-2">
      <a href="index.html" class="flex items-center text-primary bg-gray-100 rounded-lg px-2 md:px-4 py-1 md:py-2" data-translate="sidebar.dashboard">
        <i class="fas fa-tachometer-alt mr-1 md:mr-3"></i> Dashboard
      </a>
    </li>
    <li class="px-2 md:px-4 py-1 md:py-2">
      <a href="document-editor.html" class="flex items-center text-secondary hover:text-primary hover:bg-gray-100 rounded-lg px-2 md:px-4 py-1 md:py-2" data-translate="sidebar.doc_editor">
        <i class="fas fa-file-alt mr-1 md:mr-3"></i> Document Editor
      </a>
    </li>
    <li class="px-2 md:px-4 py-1 md:py-2" id="profile-nav" style="display: none;">
      <a href="#" class="flex items-center text-secondary hover:text-primary hover:bg-gray-100 rounded-lg px-2 md:px-4 py-1 md:py-2" data-translate="sidebar.profile">
        <i class="fas fa-user-circle mr-1 md:mr-3"></i> Profile
      </a>
    </li>
  </ul>
</aside>

<!-- ======= Main Content ======= -->
<main id="main" class="mt-12 md:mt-20 md:ml-64 p-0 flex-1">
  <div class="p-2 md:p-4">
    <h1 class="text-xl md:text-2xl lg:text-3xl font-bold text-primary" data-translate="main.title">AI Productivity Dashboard</h1>
    <nav class="mt-1 md:mt-2">
      <ol class="flex space-x-1 md:space-x-2 text-xs md:text-sm text-secondary">
        <li><a href="index.html" class="hover:text-primary" data-translate="main.home">Home</a></li>
        <li>/</li>
        <li class="text-primary" data-translate="main.dashboard">Dashboard</li>
      </ol>
    </nav>
  </div>

  <section class="grid grid-cols-1 lg:grid-cols-3 gap-4">
    <!-- Chatbot -->
    <div class="lg:col-span-2 p-2 md:p-4 bg-card rounded-none md:rounded-2xl shadow-sm border-0 md:border border-soft flex flex-col">
      <h2 class="text-base md:text-lg font-semibold text-primary mb-2 md:mb-4" data-translate="chat.title">Chat with AI Assistant</h2>
      <div id="chat-box" class="chat-box flex-1 overflow-y-auto p-2 md:p-4 rounded-none md:rounded-lg mb-2 md:mb-4 shadow-inner">
        <div class="message ai bg-soft text-primary rounded-lg p-2 md:p-3 max-w-[70%] shadow-sm">
          Bună! I'm your AI assistant. I can help with personal organization, email management, calendar scheduling, and time management. Try commands like "schedule a meeting," "send an email," or "get daily recommendations."
        </div>
      </div>
      <div class="typing-indicator text-muted italic hidden mb-2" data-translate="chat.typing">AI is typing...</div>
      <form id="chat-form" class="flex flex-col md:flex-row items-center space-x-1 md:space-x-2 w-full">
        <textarea id="user-input" placeholder="Type your message..." class="flex-1 w-full bg-input border border-gray-200 rounded-lg px-2 md:p-4 py-1 md:py-2 focus:outline-none focus:ring-2 focus:ring-primary resize-none h-20" data-textarea-placeholder="chat.input-placeholder"></textarea>
        <input type="file" id="file-input" accept=".txt,.md,.docx,.pdf" multiple class="hidden">
        <button type="button" id="upload-btn" title="Upload document" class="bg-accent text-primary rounded-full p-1 md:p-3 hover:bg-yellow-400 transition">
          <i class="fa fa-upload text-xs md:text-base"></i>
        </button>
        <button type="button" id="mic-btn" title="Speak your message" class="bg-success text-primary rounded-full p-1 md:p-3 hover:bg-green-600 transition">
          <i class="fa fa-microphone text-xs md:text-base"></i>
        </button>
        <button type="submit" id="send-btn" class="bg-primary text-white rounded-full p-1 md:p-3 hover:bg-blue-700 transition">
          <i class="fa fa-paper-plane text-xs md:text-base"></i>
        </button>
      </form>
      <div id="mobile-toggles" class="mt-2">
        <button id="pomodoro-toggle-btn" class="toggle-section bg-primary text-white rounded-lg px-4 py-2 w-full hover:bg-blue-700 hidden text-sm" data-translate="chat.show_pomodoro">Show Pomodoro Timer</button>
        <button id="tasks-toggle-btn" class="toggle-section bg-primary text-white rounded-lg px-4 py-2 w-full hover:bg-blue-700 hidden text-sm" data-translate="chat.show_reminders">Show Reminders</button>
        <button id="recommendations-toggle-btn" class="toggle-section bg-primary text-white rounded-lg px-4 py-2 w-full hover:bg-blue-700 hidden text-sm" data-translate="chat.show_recommendations">Show Recommendations</button>
      </div>
    </div>

    <!-- Pomodoro Timer -->
    <div id="pomodoro-container" class="p-2 md:p-4 bg-card rounded-none md:rounded-2xl shadow-sm border-0 md:border border-soft">
      <h2 class="text-base md:text-lg font-semibold text-primary mb-2 md:mb-4" data-translate="pomodoro.title">Pomodoro Timer</h2>
      <div id="pomodoro-block" class="text-center flex flex-col justify-center">
        <div id="pomodoro-timer" class="text-xl md:text-2xl font-semibold text-primary mb-2 md:mb-4">25:00</div>
        <div id="pomodoro-session" class="text-xs md:text-sm text-secondary mb-2 md:mb-4" data-translate="pomodoro.work_session">Work Session</div>
        <div class="flex justify-center space-x-1 md:space-x-2">
          <button id="pomodoro-start-btn" class="bg-success text-white rounded-lg px-2 md:px-4 py-1 md:py-2 hover:bg-green-600 flex items-center text-xs md:text-sm" data-translate="pomodoro.start"><i class="fas fa-play mr-1 md:mr-2"></i>Start</button>
          <button id="pomodoro-pause-btn" class="bg-gray-500 text-white rounded-lg px-2 md:px-4 py-1 md:py-2 hover:bg-gray-600 hidden flex items-center text-xs md:text-sm" data-translate="pomodoro.pause"><i class="fas fa-pause mr-1 md:mr-2"></i>Pause</button>
          <button id="pomodoro-reset-btn" class="bg-danger text-white rounded-lg px-2 md:px-4 py-1 md:py-2 hover:bg-red-600 flex items-center text-xs md:text-sm" data-translate="pomodoro.reset"><i class="fas fa-stop mr-1 md:mr-2"></i>Reset</button>
        </div>
      </div>
    </div>

    <!-- Daily Overview -->
    <div id="daily-overview-container" class="p-2 md:p-4 bg-card rounded-none md:rounded-2xl shadow-sm border-0 md:border border-soft">
      <h2 class="text-base md:text-lg font-semibold text-primary mb-2 md:mb-4" data-translate="overview.title">Daily Overview</h2>
      <div id="daily-overview" class="daily-overview flex-1 overflow-y-auto p-2 md:p-4 bg-card rounded-none md:rounded-lg shadow-inner"></div>
    </div>

    <!-- Reminders -->
    <div id="tasks-container" class="p-2 md:p-4 bg-card rounded-none md:rounded-2xl shadow-sm border-0 md:border border-soft flex flex-col">
      <h2 class="text-base md:text-lg font-semibold text-primary mb-2 md:mb-4" data-translate="reminders.title">Reminders</h2>
      <div id="tasks-reminders" class="tasks-reminders flex-1 overflow-y-auto p-2 md:p-4 bg-card rounded-none md:rounded-lg shadow-inner"></div>
    </div>

    <!-- Daily Recommendations -->
    <div id="recommendations-container" class="p-2 md:p-4 bg-card rounded-none md:rounded-2xl shadow-sm border-0 md:border border-soft flex flex-col">
      <h2 class="text-base md:text-lg font-semibold text-primary mb-2 md:mb-4" data-translate="recommendations.title">Daily Recommendations</h2>
      <div id="daily-recommendations" class="p-2 md:p-4 bg-card rounded-none md:rounded-lg shadow-inner flex-1">
        <p data-translate="recommendations.start_pomodoro">Start a Pomodoro session to focus on your tasks!</p>
      </div>
    </div>
  </section>

  <!-- Image Upload Modal -->
  <div id="image-upload-modal" class="modal">
    <div class="modal-content">
      <h2 data-translate="modals.upload_image.title">Upload Profile Image</h2>
      <input type="file" id="image-input" accept="image/*">
      <div class="btn-group">
        <button id="image-upload-cancel" class="bg-gray-500 text-white rounded-lg px-4 py-2 hover:bg-gray-600" data-translate="modals.cancel">Cancel</button>
        <button id="image-upload-save" class="bg-primary text-white rounded-lg px-4 py-2 hover:bg-blue-700" data-translate="modals.save">Save</button>
      </div>
    </div>
  </div>

  <!-- Email Composition Modal -->
  <div id="email-compose-modal" class="modal">
    <div class="modal-content">
      <h2 data-translate="modals.compose_email.title">Compose Email</h2>
      <input type="text" id="email-to" placeholder="To" data-placeholder="modals.compose_email.to">
      <input type="text" id="email-subject" placeholder="Subject" data-placeholder="modals.compose_email.subject">
      <textarea id="email-body" placeholder="Message" class="h-32 resize-none" data-placeholder="modals.compose_email.body"></textarea>
      <div class="btn-group">
        <button id="email-compose-cancel" class="bg-gray-500 text-white rounded-lg px-4 py-2 hover:bg-gray-600" data-translate="modals.cancel">Cancel</button>
        <button id="email-compose-send" class="bg-primary text-white rounded-lg px-4 py-2 hover:bg-blue-700" data-translate="modals.compose_email.send">Send</button>
      </div>
    </div>
  </div>

  <!-- Event Creation Modal -->
  <div id="event-create-modal" class="modal">
    <div class="modal-content">
      <h2 data-translate="modals.create_event.title">Create Calendar Event</h2>
      <input type="text" id="event-title" placeholder="Event Title" data-placeholder="modals.create_event.title_placeholder">
      <input type="datetime-local" id="event-start" placeholder="Start Time">
      <input type="datetime-local" id="event-end" placeholder="End Time">
      <textarea id="event-description" placeholder="Description" class="h-20 resize-none" data-placeholder="modals.create_event.description"></textarea>
      <div class="btn-group">
        <button id="event-create-cancel" class="bg-gray-500 text-white rounded-lg px-4 py-2 hover:bg-gray-600" data-translate="modals.cancel">Cancel</button>
        <button id="event-create-save" class="bg-primary text-white rounded-lg px-4 py-2 hover:bg-blue-700" data-translate="modals.save">Save</button>
      </div>
    </div>
  </div>
</main>

<!-- ======= Footer ======= -->
<footer class="bg-card py-2 md:py-6 text-center text-secondary w-full">
  <div class="text-xs md:text-sm">© Copyright <strong>NeuroNexis</strong>. All Rights Reserved</div>
  <div class="text-xs md:text-sm">Designed by <a href="#" class="text-primary hover:underline">Poalelungi Consulting</a></div>
</footer>

<!-- Vendor JS Files -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/js-md5@0.7.3/md5.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/marked@4.0.0/marked.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/docx@7.3.0/build/index.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/html2pdf.js@0.10.1/dist/html2pdf.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/pdfjs-dist@3.11.174/build/pdf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/mammoth@1.6.0/mammoth.browser.min.js"></script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB41DRUbKWJHPxaFjMAwdrzW5hOXy6w7k&libraries=places"></script>

<!-- Template Main JS File -->
<script>document.addEventListener('DOMContentLoaded', initializeApp);

function initializeApp() {
  // Elements
  const elements = {
    chatBox: document.getElementById('chat-box'),
    chatForm: document.getElementById('chat-form'),
    userInput: document.getElementById('user-input'),
    fileInput: document.getElementById('file-input'),
    uploadBtn: document.getElementById('upload-btn'),
    typingIndicator: document.querySelector('.typing-indicator'),
    micBtn: document.getElementById('mic-btn'),
    langSelect: document.getElementById('lang-select'),
    tasksReminders: document.getElementById('tasks-reminders'),
    dailyRecommendations: document.getElementById('daily-recommendations'),
    dailyOverview: document.getElementById('daily-overview'),
    dailyOverviewContainer: document.getElementById('daily-overview-container'),
    sidebar: document.getElementById('sidebar'),
    toggleSidebarBtn: document.getElementById('toggle-sidebar-btn'),
    closeSidebarBtn: document.getElementById('close-sidebar-btn'),
    pomodoroTimer: document.getElementById('pomodoro-timer'),
    pomodoroSession: document.getElementById('pomodoro-session'),
    pomodoroStartBtn: document.getElementById('pomodoro-start-btn'),
    pomodoroPauseBtn: document.getElementById('pomodoro-pause-btn'),
    pomodoroResetBtn: document.getElementById('pomodoro-reset-btn'),
    pomodoroContainer: document.getElementById('pomodoro-container'),
    tasksContainer: document.getElementById('tasks-container'),
    recommendationsContainer: document.getElementById('recommendations-container'),
    pomodoroToggle: document.getElementById('pomodoro-toggle-btn'),
    tasksToggle: document.getElementById('tasks-toggle-btn'),
    recommendationsToggle: document.getElementById('recommendations-toggle-btn'),
    profileBtn: document.getElementById('profile-btn'),
    profileDropdown: document.getElementById('profile-dropdown'),
    googleSignInBtn: document.getElementById('google-signin-btn'),
    facebookSignInBtn: document.getElementById('facebook-signin-btn'),
    instagramSignInBtn: document.getElementById('instagram-signin-btn'),
    logoutBtn: document.getElementById('logout-btn'),
    headerProfileImage: document.getElementById('header-profile-image'),
    userName: document.getElementById('user-name'),
    userFullname: document.getElementById('user-fullname'),
    userRole: document.getElementById('user-role'),
    profileNav: document.getElementById('profile-nav'),
    themeToggle: document.getElementById('theme-toggle'),
    imageUploadModal: document.getElementById('image-upload-modal'),
    imageInput: document.getElementById('image-input'),
    imageUploadSave: document.getElementById('image-upload-save'),
    imageUploadCancel: document.getElementById('image-upload-cancel'),
    uploadImageBtn: document.getElementById('upload-image-btn'),
    emailComposeModal: document.getElementById('email-compose-modal'),
    emailTo: document.getElementById('email-to'),
    emailSubject: document.getElementById('email-subject'),
    emailBody: document.getElementById('email-body'),
    emailComposeSend: document.getElementById('email-compose-send'),
    emailComposeCancel: document.getElementById('email-compose-cancel'),
    eventCreateModal: document.getElementById('event-create-modal'),
    eventTitle: document.getElementById('event-title'),
    eventStart: document.getElementById('event-start'),
    eventEnd: document.getElementById('event-end'),
    eventDescription: document.getElementById('event-description'),
    eventCreateSave: document.getElementById('event-create-save'),
    eventCreateCancel: document.getElementById('event-create-cancel')
  };

  // Check if all elements are found
  for (const [key, element] of Object.entries(elements)) {
    if (!element) {
      console.error(`Element not found: ${key}`);
      return;
    }
  }

  // User Data and Authentication
  let currentUser = localStorage.getItem('currentUser') || 'guest';
  let userData = JSON.parse(localStorage.getItem('userData')) || {
    guest: { name: 'Guest', email: 'guest@example.com', profileImage: 'assets/img/profile-img.jpg', reminders: [], chats: [] }
  };
  let users = JSON.parse(localStorage.getItem('users')) || {};
  let reminders = userData[currentUser]?.reminders || [];
  let chats = userData[currentUser]?.chats || [];

  // Theme Management
  let currentTheme = localStorage.getItem('theme') || 'light';
  document.body.setAttribute('data-theme', currentTheme);
  elements.themeToggle.innerHTML = currentTheme === 'light' ? '<i class="fas fa-moon text-lg md:text-xl"></i>' : '<i class="fas fa-sun text-lg md:text-xl"></i>';

  elements.themeToggle.addEventListener('click', () => {
    currentTheme = currentTheme === 'light' ? 'dark' : 'light';
    document.body.setAttribute('data-theme', currentTheme);
    localStorage.setItem('theme', currentTheme);
    elements.themeToggle.innerHTML = currentTheme === 'light' ? '<i class="fas fa-moon text-lg md:text-xl"></i>' : '<i class="fas fa-sun text-lg md:text-xl"></i>';
  });

  // Translation Data
  const translations = {
    'en-US': {
      'header.title': 'NEURONEXIS',
      'header.search': 'Search...',
      'sidebar.menu': 'Menu',
      'sidebar.dashboard': 'Dashboard',
      'sidebar.doc_editor': 'Document Editor',
      'sidebar.profile': 'Profile',
      'profile.upload_image': 'Upload Image',
      'profile.settings': 'Account Settings',
      'profile.help': 'Need Help?',
      'profile.google_signin': 'Sign in with Google',
      'profile.facebook_signin': 'Sign in with Facebook',
      'profile.instagram_signin': 'Sign in with Instagram',
      'profile.signout': 'Sign Out',
      'main.title': 'AI Productivity Dashboard',
      'main.home': 'Home',
      'main.dashboard': 'Dashboard',
      'chat.title': 'Chat with AI Assistant',
      'chat.typing': 'AI is typing...',
      'chat.input-placeholder': 'Type your message...',
      'chat.listening': 'Listening...',
      'chat.show_pomodoro': 'Show Pomodoro Timer',
      'chat.show_reminders': 'Show Reminders',
      'chat.show_recommendations': 'Show Recommendations',
      'pomodoro.title': 'Pomodoro Timer',
      'pomodoro.work_session': 'Work Session',
      'pomodoro.break_session': 'Break Session',
      'pomodoro.start': 'Start',
      'pomodoro.pause': 'Pause',
      'pomodoro.reset': 'Reset',
      'overview.title': 'Daily Overview',
      'reminders.title': 'Reminders',
      'recommendations.title': 'Daily Recommendations',
      'recommendations.start_pomodoro': 'Start a Pomodoro session to focus on your tasks!',
      'modals.upload_image.title': 'Upload Profile Image',
      'modals.compose_email.title': 'Compose Email',
      'modals.compose_email.to': 'To',
      'modals.compose_email.subject': 'Subject',
      'modals.compose_email.body': 'Message',
      'modals.compose_email.send': 'Send',
      'modals.create_event.title': 'Create Calendar Event',
      'modals.create_event.title_placeholder': 'Event Title',
      'modals.create_event.description': 'Description',
      'modals.cancel': 'Cancel',
      'modals.save': 'Save'
    },
    'ro-RO': {
      'header.title': 'NEURONEXIS',
      'header.search': 'Caută...',
      'sidebar.menu': 'Meniu',
      'sidebar.dashboard': 'Panou de control',
      'sidebar.doc_editor': 'Editor de documente',
      'sidebar.profile': 'Profil',
      'profile.upload_image': 'Încarcă imagine',
      'profile.settings': 'Setări cont',
      'profile.help': 'Ai nevoie de ajutor?',
      'profile.google_signin': 'Conectează-te cu Google',
      'profile.facebook_signin': 'Conectează-te cu Facebook',
      'profile.instagram_signin': 'Conectează-te cu Instagram',
      'profile.signout': 'Deconectare',
      'main.title': 'Panou de productivitate AI',
      'main.home': 'Acasă',
      'main.dashboard': 'Panou de control',
      'chat.title': 'Chat cu asistentul AI',
      'chat.typing': 'AI-ul tastează...',
      'chat.input-placeholder': 'Tastează mesajul tău...',
      'chat.listening': 'Ascult...',
      'chat.show_pomodoro': 'Afișează temporizatorul Pomodoro',
      'chat.show_reminders': 'Afișează memento-uri',
      'chat.show_recommendations': 'Afișează recomandări',
      'pomodoro.title': 'Temporizator Pomodoro',
      'pomodoro.work_session': 'Sesiune de lucru',
      'pomodoro.break_session': 'Sesiune de pauză',
      'pomodoro.start': 'Start',
      'pomodoro.pause': 'Pauză',
      'pomodoro.reset': 'Resetare',
      'overview.title': 'Prezentare zilnică',
      'reminders.title': 'Memento-uri',
      'recommendations.title': 'Recomandări zilnice',
      'recommendations.start_pomodoro': 'Începe o sesiune Pomodoro pentru a te concentra pe sarcinile tale!',
      'modals.upload_image.title': 'Încarcă imaginea de profil',
      'modals.compose_email.title': 'Compune email',
      'modals.compose_email.to': 'Către',
      'modals.compose_email.subject': 'Subiect',
      'modals.compose_email.body': 'Mesaj',
      'modals.compose_email.send': 'Trimite',
      'modals.create_event.title': 'Creează eveniment în calendar',
      'modals.create_event.title_placeholder': 'Titlu eveniment',
      'modals.create_event.description': 'Descriere',
      'modals.cancel': 'Anulează',
      'modals.save': 'Salvează'
    },
    'ru-RU': {
      'header.title': 'NEURONEXIS',
      'header.search': 'Поиск...',
      'sidebar.menu': 'Меню',
      'sidebar.dashboard': 'Панель управления',
      'sidebar.doc_editor': 'Редактор документов',
      'sidebar.profile': 'Профиль',
      'profile.upload_image': 'Загрузить изображение',
      'profile.settings': 'Настройки аккаунта',
      'profile.help': 'Нужна помощь?',
      'profile.google_signin': 'Войти через Google',
      'profile.facebook_signin': 'Войти через Facebook',
      'profile.instagram_signin': 'Войти через Instagram',
      'profile.signout': 'Выйти',
      'main.title': 'Панель продуктивности AI',
      'main.home': 'Главная',
      'main.dashboard': 'Панель управления',
      'chat.title': 'Чат с AI-ассистентом',
      'chat.typing': 'AI печатает...',
      'chat.input-placeholder': 'Введите ваше сообщение...',
      'chat.listening': 'Слушаю...',
      'chat.show_pomodoro': 'Показать таймер Помодоро',
      'chat.show_reminders': 'Показать напоминания',
      'chat.show_recommendations': 'Показать рекомендации',
      'pomodoro.title': 'Таймер Помодоро',
      'pomodoro.work_session': 'Рабочая сессия',
      'pomodoro.break_session': 'Сессия перерыва',
      'pomodoro.start': 'Старт',
      'pomodoro.pause': 'Пауза',
      'pomodoro.reset': 'Сброс',
      'overview.title': 'Ежедневный обзор',
      'reminders.title': 'Напоминания',
      'recommendations.title': 'Ежедневные рекомендации',
      'recommendations.start_pomodoro': 'Начните сессию Помодоро, чтобы сосредоточиться на задачах!',
      'modals.upload_image.title': 'Загрузить изображение профиля',
      'modals.compose_email.title': 'Написать письмо',
      'modals.compose_email.to': 'Кому',
      'modals.compose_email.subject': 'Тема',
      'modals.compose_email.body': 'Сообщение',
      'modals.compose_email.send': 'Отправить',
      'modals.create_event.title': 'Создать событие в календаре',
      'modals.create_event.title_placeholder': 'Название события',
      'modals.create_event.description': 'Описание',
      'modals.cancel': 'Отмена',
      'modals.save': 'Сохранить'
    },
    'es-ES': {
      'header.title': 'NEURONEXIS',
      'header.search': 'Buscar...',
      'sidebar.menu': 'Menú',
      'sidebar.dashboard': 'Panel de control',
      'sidebar.doc_editor': 'Editor de documentos',
      'sidebar.profile': 'Perfil',
      'profile.upload_image': 'Subir imagen',
      'profile.settings': 'Configuración de la cuenta',
      'profile.help': '¿Necesitas ayuda?',
      'profile.google_signin': 'Iniciar sesión con Google',
      'profile.facebook_signin': 'Iniciar sesión con Facebook',
      'profile.instagram_signin': 'Iniciar sesión con Instagram',
      'profile.signout': 'Cerrar sesión',
      'main.title': 'Panel de productividad AI',
      'main.home': 'Inicio',
      'main.dashboard': 'Panel de control',
      'chat.title': 'Chatea con el asistente AI',
      'chat.typing': 'El AI está escribiendo...',
      'chat.input-placeholder': 'Escribe tu mensaje...',
      'chat.listening': 'Escuchando...',
      'chat.show_pomodoro': 'Mostrar temporizador Pomodoro',
      'chat.show_reminders': 'Mostrar recordatorios',
      'chat.show_recommendations': 'Mostrar recomendaciones',
      'pomodoro.title': 'Temporizador Pomodoro',
      'pomodoro.work_session': 'Sesión de trabajo',
      'pomodoro.break_session': 'Sesión de descanso',
      'pomodoro.start': 'Iniciar',
      'pomodoro.pause': 'Pausar',
      'pomodoro.reset': 'Reiniciar',
      'overview.title': 'Resumen diario',
      'reminders.title': 'Recordatorios',
      'recommendations.title': 'Recomendaciones diarias',
      'recommendations.start_pomodoro': '¡Inicia una sesión Pomodoro para enfocarte en tus tareas!',
      'modals.upload_image.title': 'Subir imagen de perfil',
      'modals.compose_email.title': 'Redactar correo',
      'modals.compose_email.to': 'Para',
      'modals.compose_email.subject': 'Asunto',
      'modals.compose_email.body': 'Mensaje',
      'modals.compose_email.send': 'Enviar',
      'modals.create_event.title': 'Crear evento en el calendario',
      'modals.create_event.title_placeholder': 'Título del evento',
      'modals.create_event.description': 'Descripción',
      'modals.cancel': 'Cancelar',
      'modals.save': 'Guardar'
    },
    'fr-FR': {
      'header.title': 'NEURONEXIS',
      'header.search': 'Rechercher...',
      'sidebar.menu': 'Menu',
      'sidebar.dashboard': 'Tableau de bord',
      'sidebar.doc_editor': 'Éditeur de documents',
      'sidebar.profile': 'Profil',
      'profile.upload_image': 'Télécharger une image',
      'profile.settings': 'Paramètres du compte',
      'profile.help': 'Besoin d’aide ?',
      'profile.google_signin': 'Se connecter avec Google',
      'profile.facebook_signin': 'Se connecter avec Facebook',
      'profile.instagram_signin': 'Se connecter avec Instagram',
      'profile.signout': 'Se déconnecter',
      'main.title': 'Tableau de productivité AI',
      'main.home': 'Accueil',
      'main.dashboard': 'Tableau de bord',
      'chat.title': 'Chat avec l’assistant AI',
      'chat.typing': 'L’AI est en train de taper...',
      'chat.input-placeholder': 'Tapez votre message...',
      'chat.listening': 'Écoute...',
      'chat.show_pomodoro': 'Afficher le minuteur Pomodoro',
      'chat.show_reminders': 'Afficher les rappels',
      'chat.show_recommendations': 'Afficher les recommandations',
      'pomodoro.title': 'Minuteur Pomodoro',
      'pomodoro.work_session': 'Session de travail',
      'pomodoro.break_session': 'Session de pause',
      'pomodoro.start': 'Démarrer',
      'pomodoro.pause': 'Pause',
      'pomodoro.reset': 'Réinitialiser',
      'overview.title': 'Aperçu quotidien',
      'reminders.title': 'Rappels',
      'recommendations.title': 'Recommandations quotidiennes',
      'recommendations.start_pomodoro': 'Commencez une session Pomodoro pour vous concentrer sur vos tâches !',
      'modals.upload_image.title': 'Télécharger une image de profil',
      'modals.compose_email.title': 'Rédiger un email',
      'modals.compose_email.to': 'À',
      'modals.compose_email.subject': 'Objet',
      'modals.compose_email.body': 'Message',
      'modals.compose_email.send': 'Envoyer',
      'modals.create_event.title': 'Créer un événement dans le calendrier',
      'modals.create_event.title_placeholder': 'Titre de l’événement',
      'modals.create_event.description': 'Description',
      'modals.cancel': 'Annuler',
      'modals.save': 'Enregistrer'
    }
  };

  // Language Management
  let currentLang = localStorage.getItem('language') || 'ro-RO'; // Default to Romanian
  elements.langSelect.value = currentLang;

  function updateTranslations() {
    document.querySelectorAll('[data-translate]').forEach(element => {
      const key = element.getAttribute('data-translate');
      element.textContent = translations[currentLang][key] || element.textContent;
    });
    document.querySelectorAll('[data-placeholder]').forEach(element => {
      const key = element.getAttribute('data-placeholder');
      element.setAttribute('placeholder', translations[currentLang][key] || element.getAttribute('placeholder'));
    });
    document.querySelectorAll('[data-textarea-placeholder]').forEach(element => {
      const key = element.getAttribute('data-textarea-placeholder');
      element.setAttribute('placeholder', translations[currentLang][key] || element.getAttribute('placeholder'));
    });
  }

  elements.langSelect.addEventListener('change', () => {
    currentLang = elements.langSelect.value;
    localStorage.setItem('language', currentLang);
    updateTranslations();
  });

  updateTranslations();

  // Request Permissions
  if (Notification.permission !== 'granted') {
    Notification.requestPermission();
  }

  // User Data Management
  function loadProfile() {
    elements.headerProfileImage.src = userData[currentUser].profileImage || 'assets/img/profile-img.jpg';
    elements.userName.textContent = userData[currentUser].name || 'Guest';
    elements.userFullname.textContent = userData[currentUser].name || 'Guest';
    elements.userRole.textContent = userData[currentUser].email || 'Guest User';
    renderReminders();
    generateDailyOverview();
    generateDailyRecommendations();
    scheduleWorkReminder();
  }

  function saveUserData() {
    localStorage.setItem('userData', JSON.stringify(userData));
    localStorage.setItem('users', JSON.stringify(users));
  }

  // Authentication Handlers
  elements.facebookSignInBtn.addEventListener('click', () => {
    const mockUser = { name: 'Facebook User', email: 'facebook@example.com', profileImage: 'assets/img/profile-img.jpg', bio: 'Loves traveling and photography' };
    currentUser = mockUser.email;
    userData[currentUser] = mockUser;
    users[currentUser] = mockUser;
    localStorage.setItem('currentUser', currentUser);
    localStorage.setItem('userData', JSON.stringify(userData));
    localStorage.setItem('users', JSON.stringify(users));
    loadProfile();
    addMessage('Signed in with Facebook! Limited features available.', 'ai');
  });

  elements.instagramSignInBtn.addEventListener('click', () => {
    const mockUser = { name: 'Instagram User', email: 'instagram@example.com', profileImage: 'assets/img/profile-img.jpg', bio: 'Foodie and fitness enthusiast' };
    currentUser = mockUser.email;
    userData[currentUser] = mockUser;
    users[currentUser] = mockUser;
    localStorage.setItem('currentUser', currentUser);
    localStorage.setItem('userData', JSON.stringify(userData));
    localStorage.setItem('users', JSON.stringify(users));
    loadProfile();
    addMessage('Signed in with Instagram! Limited features available.', 'ai');
  });

  elements.logoutBtn.addEventListener('click', () => {
    currentUser = 'guest';
    userData[currentUser] = { name: 'Guest', email: 'guest@example.com', profileImage: 'assets/img/profile-img.jpg', reminders: [], chats: [] };
    users = {};
    localStorage.setItem('currentUser', currentUser);
    localStorage.setItem('userData', JSON.stringify(userData));
    localStorage.setItem('users', JSON.stringify(users));
    loadProfile();
    elements.chatBox.innerHTML = '';
    addMessage('You have been signed out. Hello! I’m your AI assistant. Try commands like "schedule a meeting" or "get daily recommendations."', 'ai');
  });

  // Sidebar Toggle
  elements.toggleSidebarBtn.addEventListener('click', () => {
    elements.sidebar.classList.toggle('-translate-x-full');
  });

  elements.closeSidebarBtn.addEventListener('click', () => {
    elements.sidebar.classList.add('-translate-x-full');
  });

  // Toggle Sections on Mobile
  let isPomodoroVisible = false;
  let isTasksVisible = false;
  let isRecommendationsVisible = false;

  elements.pomodoroToggle.addEventListener('click', () => {
    isPomodoroVisible = !isPomodoroVisible;
    elements.pomodoroContainer.style.display = isPomodoroVisible ? 'block' : 'none';
    elements.pomodoroToggle.textContent = isPomodoroVisible ? translations[currentLang]['chat.hide_pomodoro'] || 'Hide Pomodoro Timer' : translations[currentLang]['chat.show_pomodoro'];
  });

  elements.tasksToggle.addEventListener('click', () => {
    isTasksVisible = !isTasksVisible;
    elements.tasksContainer.style.display = isTasksVisible ? 'block' : 'none';
    elements.tasksToggle.textContent = isTasksVisible ? translations[currentLang]['chat.hide_reminders'] || 'Hide Reminders' : translations[currentLang]['chat.show_reminders'];
  });

  elements.recommendationsToggle.addEventListener('click', () => {
    isRecommendationsVisible = !isRecommendationsVisible;
    elements.recommendationsContainer.style.display = isRecommendationsVisible ? 'block' : 'none';
    elements.recommendationsToggle.textContent = isRecommendationsVisible ? translations[currentLang]['chat.hide_recommendations'] || 'Hide Recommendations' : translations[currentLang]['chat.show_recommendations'];
  });

  // Pomodoro Timer Logic
  let pomodoroState = JSON.parse(localStorage.getItem('pomodoroState')) || {
    active: false,
    paused: false,
    time: 25 * 60,
    isWorkSession: true,
    lastUpdate: Date.now()
  };
  let pomodoroInterval = null;

  function updatePomodoroDisplay() {
    const minutes = Math.floor(pomodoroState.time / 60);
    const seconds = Math.floor(pomodoroState.time % 60);
    elements.pomodoroTimer.textContent = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
    elements.pomodoroSession.textContent = pomodoroState.isWorkSession ? translations[currentLang]['pomodoro.work_session'] : translations[currentLang]['pomodoro.break_session'];
    elements.pomodoroStartBtn.classList.toggle('hidden', pomodoroState.active && !pomodoroState.paused);
    elements.pomodoroPauseBtn.classList.toggle('hidden', !pomodoroState.active || pomodoroState.paused);
  }

  function savePomodoroState() {
    localStorage.setItem('pomodoroState', JSON.stringify(pomodoroState));
  }

  function startPomodoro() {
    if (!pomodoroState.active) {
      pomodoroState.active = true;
      pomodoroState.paused = false;
      pomodoroState.lastUpdate = Date.now();
      pomodoroInterval = setInterval(() => {
        if (!pomodoroState.paused) {
          const now = Date.now();
          const elapsed = (now - pomodoroState.lastUpdate) / 1000;
          pomodoroState.time -= Math.floor(elapsed);
          pomodoroState.lastUpdate = now;
          if (pomodoroState.time <= 0) {
            clearInterval(pomodoroInterval);
            pomodoroState.active = false;
            pomodoroState.isWorkSession = !pomodoroState.isWorkSession;
            pomodoroState.time = pomodoroState.isWorkSession ? 25 * 60 : 5 * 60;
            savePomodoroState();
            updatePomodoroDisplay();
            new Notification('Pomodoro Complete', {
              body: pomodoroState.isWorkSession ? translations[currentLang]['pomodoro.break_session'] : translations[currentLang]['pomodoro.work_session']
            });
            startPomodoro();
          } else {
            savePomodoroState();
            updatePomodoroDisplay();
          }
        }
      }, 1000);
      savePomodoroState();
      updatePomodoroDisplay();
    }
  }

  function pausePomodoro() {
    if (pomodoroState.active && !pomodoroState.paused) {
      pomodoroState.paused = true;
      clearInterval(pomodoroInterval);
      savePomodoroState();
      updatePomodoroDisplay();
    }
  }

  function resetPomodoro() {
    clearInterval(pomodoroInterval);
    pomodoroState = {
      active: false,
      paused: false,
      time: 25 * 60,
      isWorkSession: true,
      lastUpdate: Date.now()
    };
    savePomodoroState();
    updatePomodoroDisplay();
  }

  elements.pomodoroStartBtn.addEventListener('click', startPomodoro);
  elements.pomodoroPauseBtn.addEventListener('click', pausePomodoro);
  elements.pomodoroResetBtn.addEventListener('click', resetPomodoro);

  updatePomodoroDisplay();

  // Chat Functionality
  function addMessage(message, sender = 'user', imageUrl = null) {
    const messageDiv = document.createElement('div');
    messageDiv.className = `message ${sender} ${sender === 'ai' ? 'bg-soft text-primary' : 'bg-gray-200 text-gray-800'} rounded-lg p-2 md:p-3 max-w-[70%] shadow-sm mb-2`;
    messageDiv.innerHTML = imageUrl ? `<img src="${imageUrl}" alt="Attached image" class="mb-2">` : '';
    messageDiv.innerHTML += message.replace(/\n/g, '<br>');
    elements.chatBox.appendChild(messageDiv);
    elements.chatBox.scrollTop = elements.chatBox.scrollHeight;
    chats.push({ sender, message, timestamp: new Date().toISOString() });
    userData[currentUser].chats = chats;
    saveUserData();
  }

  function showTypingIndicator(show = true) {
    elements.typingIndicator.classList.toggle('hidden', !show);
  }

  elements.uploadBtn.addEventListener('click', () => elements.fileInput.click());

  elements.fileInput.addEventListener('change', (e) => {
    const file = e.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = (e) => {
        addMessage(`Uploaded file: ${file.name}\nContent: ${e.target.result.substring(0, 100)}...`, 'user');
        handleInput(`File uploaded: ${file.name}`);
      };
      reader.readAsText(file);
    }
  });

  let recognition = null;
  if ('webkitSpeechRecognition' in window) {
    recognition = new webkitSpeechRecognition();
    recognition.continuous = false;
    recognition.interimResults = false;
    recognition.lang = currentLang;

    elements.micBtn.addEventListener('click', () => {
      if (!recognition) {
        addMessage('Speech recognition not supported in this browser.', 'ai');
        return;
      }
      recognition.start();
      addMessage(translations[currentLang]['chat.listening'] || 'Listening...', 'ai');
      elements.micBtn.classList.add('bg-red-500', 'hover:bg-red-600');
      elements.micBtn.querySelector('i').classList.remove('fa-microphone');
      elements.micBtn.querySelector('i').classList.add('fa-microphone-slash');
    });

    recognition.onresult = (event) => {
      const transcript = event.results[0][0].transcript;
      elements.userInput.value = transcript;
      addMessage(transcript, 'user');
      handleInput(transcript);
      stopRecognition();
    };

    recognition.onerror = (event) => {
      console.error('Speech recognition error:', event.error);
      addMessage('Speech recognition failed. Please try again.', 'ai');
      stopRecognition();
    };

    recognition.onend = stopRecognition;

    function stopRecognition() {
      elements.micBtn.classList.remove('bg-red-500', 'hover:bg-red-600');
      elements.micBtn.querySelector('i').classList.remove('fa-microphone-slash');
      elements.micBtn.querySelector('i').classList.add('fa-microphone');
    }
  } else {
    elements.micBtn.style.display = 'none';
    addMessage('Speech recognition not supported in this browser.', 'ai');
  }

  elements.chatForm.addEventListener('submit', (e) => {
    e.preventDefault();
    const message = elements.userInput.value.trim();
    if (message) {
      addMessage(message, 'user');
      handleInput(message);
      elements.userInput.value = '';
    }
  });

  function handleInput(message) {
    showTypingIndicator(true);
    setTimeout(() => {
      const lowerMessage = message.toLowerCase();
      let response = 'Nu am înțeles. Încearcă comenzi precum "planifică o întâlnire", "trimite un email" sau "recomandări zilnice".';

      if (lowerMessage.includes('bună') || lowerMessage.includes('salut')) {
        response = 'Bună! Cum pot să te ajut astăzi?';
      } else if (lowerMessage.includes('planifică o întâlnire') || lowerMessage.includes('schedule a meeting')) {
        if (currentUser !== 'guest') {
          elements.eventCreateModal.style.display = 'flex';
          response = 'Te rog completează detaliile evenimentului în fereastra modală pentru a planifica o întâlnire.';
        } else {
          response = 'Te rog conectează-te cu Google pentru a planifica o întâlnire.';
        }
      } else if (lowerMessage.includes('trimite un email') || lowerMessage.includes('send an email')) {
        if (currentUser !== 'guest') {
          elements.emailComposeModal.style.display = 'flex';
          response = 'Te rog completează detaliile emailului în fereastra modală pentru a-l trimite.';
        } else {
          response = 'Te rog conectează-te cu Google pentru a trimite un email.';
        }
      } else if (lowerMessage.includes('recomandări zilnice') || lowerMessage.includes('get daily recommendations')) {
        response = 'Recomandare: Începe o sesiune Pomodoro pentru a te concentra pe sarcinile tale! Verifică și memento-urile zilnice.';
      } else if (lowerMessage.includes('set reminder')) {
        const timeMatch = message.match(/\s(at|for|la)\s(\d{1,2}:\d{2}\s?(AM|PM)?)/i);
        if (timeMatch) {
          const reminderTime = timeMatch[2];
          reminders.push({ text: message.replace(timeMatch[0], '').trim(), time: reminderTime, created: new Date().toISOString() });
          userData[currentUser].reminders = reminders;
          saveUserData();
          renderReminders();
          response = `Memento setat pentru ${reminderTime}.`;
        } else {
          response = 'Te rog specifică o oră, ex. "set reminder to call John la 15:00".';
        }
      }

      addMessage(response, 'ai');
      showTypingIndicator(false);
    }, 1000);
  }

  // Modal Event Handlers
  elements.imageUploadCancel.addEventListener('click', () => {
    elements.imageUploadModal.style.display = 'none';
    elements.imageInput.value = '';
  });

  elements.imageUploadSave.addEventListener('click', () => {
    const file = elements.imageInput.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = (e) => {
        userData[currentUser].profileImage = e.target.result;
        saveUserData();
        loadProfile();
        elements.imageUploadModal.style.display = 'none';
        elements.imageInput.value = '';
        addMessage('Imaginea de profil a fost actualizată cu succes!', 'ai');
      };
      reader.readAsDataURL(file);
    }
  });

  elements.emailComposeCancel.addEventListener('click', () => {
    elements.emailComposeModal.style.display = 'none';
    elements.emailTo.value = '';
    elements.emailSubject.value = '';
    elements.emailBody.value = '';
  });

  elements.emailComposeSend.addEventListener('click', () => {
    if (currentUser !== 'guest') {
      const to = elements.emailTo.value;
      const subject = elements.emailSubject.value;
      const body = elements.emailBody.value;
      if (to && subject && body) {
        addMessage(`Email trimis către ${to} cu subiectul "${subject}".`, 'ai');
        elements.emailComposeModal.style.display = 'none';
        elements.emailTo.value = '';
        elements.emailSubject.value = '';
        elements.emailBody.value = '';
      } else {
        addMessage('Te rog completează toate câmpurile emailului.', 'ai');
      }
    } else {
      addMessage('Te rog conectează-te cu Google pentru a trimite emailuri.', 'ai');
    }
  });

  elements.eventCreateCancel.addEventListener('click', () => {
    elements.eventCreateModal.style.display = 'none';
    elements.eventTitle.value = '';
    elements.eventStart.value = '';
    elements.eventEnd.value = '';
    elements.eventDescription.value = '';
  });

  elements.eventCreateSave.addEventListener('click', () => {
    if (currentUser !== 'guest') {
      const event = {
        summary: elements.eventTitle.value,
        start: { dateTime: elements.eventStart.value, timeZone: 'Europe/Bucharest' },
        end: { dateTime: elements.eventEnd.value, timeZone: 'Europe/Bucharest' },
        description: elements.eventDescription.value
      };
      if (event.summary && event.start.dateTime && event.end.dateTime) {
        addMessage(`Eveniment "${event.summary}" creat cu succes.`, 'ai');
        elements.eventCreateModal.style.display = 'none';
        elements.eventTitle.value = '';
        elements.eventStart.value = '';
        elements.eventEnd.value = '';
        elements.eventDescription.value = '';
      } else {
        addMessage('Te rog completează toate câmpurile obligatorii ale evenimentului.', 'ai');
      }
    } else {
      addMessage('Te rog conectează-te cu Google pentru a crea evenimente.', 'ai');
    }
  });

  // Profile and Dropdown
  elements.profileBtn.addEventListener('click', () => {
    elements.profileDropdown.classList.toggle('hidden');
  });

  document.addEventListener('click', (e) => {
    if (!elements.profileBtn.contains(e.target) && !elements.profileDropdown.contains(e.target)) {
      elements.profileDropdown.classList.add('hidden');
    }
  });

  elements.uploadImageBtn.addEventListener('click', (e) => {
    e.preventDefault();
    elements.imageUploadModal.style.display = 'flex';
  });

  // Render Reminders and Overview
  function renderReminders() {
    elements.tasksReminders.innerHTML = '';
    reminders.forEach(reminder => {
      const reminderDiv = document.createElement('div');
      reminderDiv.className = 'bg-gray-100 p-2 rounded-lg mb-2 text-sm';
      reminderDiv.textContent = `${reminder.text} (Set for ${reminder.time})`;
      elements.tasksReminders.appendChild(reminderDiv);
    });
  }

  function addOverviewItem(text, type) {
    const itemDiv = document.createElement('div');
    itemDiv.className = 'overview-item bg-gray-100 p-2 rounded-lg mb-2 text-sm';
    itemDiv.textContent = text;
    elements.dailyOverview.appendChild(itemDiv);
  }

  function generateDailyOverview() {
    elements.dailyOverview.innerHTML = '';
    const now = new Date('2025-06-05T09:10:00+03:00'); // Updated date and time
    addOverviewItem(`Astăzi este ${now.toLocaleDateString(currentLang, { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })} ${now.toLocaleTimeString(currentLang, { hour: '2-digit', minute: '2-digit' })} EEST.`, 'date');
  }

  function generateDailyRecommendations() {
    elements.dailyRecommendations.innerHTML = translations[currentLang]['recommendations.start_pomodoro'] || 'Start a Pomodoro session to focus on your tasks!';
  }

  function scheduleWorkReminder() {
    const now = new Date('2025-06-05T09:10:00+03:00');
    const reminderTime = new Date(now);
    reminderTime.setHours(10, 0, 0, 0); // 10:00 AM EEST
    if (now < reminderTime) {
      setTimeout(() => {
        new Notification('Memento de lucru', { body: 'Timpul să-ți începi ziua de lucru!' });
        reminders.push({ text: 'Începe ziua de lucru', time: '10:00', created: now.toISOString() });
        userData[currentUser].reminders = reminders;
        saveUserData();
        renderReminders();
      }, reminderTime - now);
    }
  }

  // Initial Load
  loadProfile();
  generateDailyOverview();
  generateDailyRecommendations();
  scheduleWorkReminder();
  addMessage('Bună! Sunt asistentul tău AI. Pot ajuta cu organizarea personală, gestionarea emailurilor, planificarea calendarului și managementul timpului. Încearcă comenzi precum "planifică o întâlnire" sau "recomandări zilnice."', 'ai');
}</script>
</body>
</html>