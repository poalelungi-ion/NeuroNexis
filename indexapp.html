<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>AI Productivity Dashboard - NEURONEXIS</title>
  <meta content="AI-powered productivity dashboard for calendar and email management" name="description">
  <meta content="AI, productivity, dashboard, NEURONEXIS" name="keywords">
  <link href="assets/img/favicon.png" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked@4.0.0/marked.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/docx@7.3.0/build/index.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/html2pdf.js@0.10.1/dist/html2pdf.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/pdfjs-dist@3.11.174/build/pdf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mammoth@1.6.0/mammoth.browser.min.js"></script>
  <script src="https://apis.google.com/js/api.js" async defer></script>
  <script src="https://cdn.jsdelivr.net/npm/@google-cloud/translate@2.2.0/build/src/index.min.js"></script>
  <style>
    body, html {
      height: 100%;
      margin: 0;
      padding: 0;
      font-family: 'Inter', sans-serif;
    }
    #header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 50;
      background: white;
      padding: 10px 20px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    #sidebar {
      width: 250px;
      background: #f8f9fa;
      position: fixed;
      top: 60px;
      bottom: 0;
      padding-top: 10px;
      transition: transform 0.3s ease;
      z-index: 40;
    }
    #sidebar.active {
      transform: translateX(0);
    }
    #main {
      margin-top: 60px;
      margin-left: 250px;
      height: calc(100vh - 60px);
      display: flex;
      flex-direction: column;
    }
    #chat-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      background: linear-gradient(135deg, #e0eafc, #cfdef3);
    }
    #chat-box {
      flex: 1;
      overflow-y: auto;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .message {
      max-width: 60%;
      padding: 10px 15px;
      border-radius: 15px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    .message.user {
      background: #075e54;
      color: white;
      align-self: flex-end;
      border-bottom-right-radius: 0;
    }
    .message.ai {
      background: #e8eaf6;
      color: #333;
      align-self: flex-start;
      border-bottom-left-radius: 0;
    }
    #input-area {
      padding: 10px;
      background: white;
      border-top: 1px solid #ddd;
      display: flex;
      gap: 10px;
      position: sticky;
      bottom: 0;
      z-index: 30;
    }
    #user-input {
      flex: 1;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 20px;
      outline: none;
    }
    #send-btn {
      background: #075e54;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 20px;
      cursor: pointer;
    }
    #send-btn:hover {
      background: #054d44;
    }
    .dialog-item {
      padding: 5px 10px;
      cursor: pointer;
    }
    .dialog-item:hover {
      background: #f0f0f0;
    }
    @media (max-width: 768px) {
      #sidebar {
        transform: translateX(-250px);
      }
      #main {
        margin-left: 0;
      }
      #chat-container {
        margin-left: 0;
      }
      .message {
        max-width: 80%;
      }
    }
  </style>
</head>
<body class="bg-gray-100">
<header id="header">
  <div class="flex items-center justify-between">
    <button id="toggle-sidebar-btn" class="md:hidden mr-2 text-gray-600">
      <i class="fas fa-bars"></i>
    </button>
    <span class="text-xl font-semibold text-gray-800">NEURONEXIS</span>
    <button id="profile-btn" class="flex items-center space-x-2 text-gray-700">
      <span id="user-name">Guest</span>
      <i class="fas fa-user-circle"></i>
    </button>
  </div>
</header>
<aside id="sidebar">
  <div class="p-4 border-b">
    <h2 class="text-lg font-semibold">Menu</h2>
  </div>
  <ul class="p-4 space-y-2">
    <li>
      <a href="index.html" class="flex items-center p-2 text-gray-700 hover:bg-gray-200 rounded" data-translate="dashboard">
        <i class="fas fa-tachometer-alt mr-2"></i> Dashboard
      </a>
    </li>
    <li>
      <a href="document-editor.html" class="flex items-center p-2 text-gray-700 hover:bg-gray-200 rounded" data-translate="document-editor">
        <i class="fas fa-file-alt mr-2"></i> Document Editor
      </a>
    </li>
    <li id="login-nav">
      <a id="google-login-btn" class="flex items-center p-2 text-gray-700 hover:bg-gray-200 rounded" data-translate="login-with-google">
        <i class="fas fa-sign-in-alt mr-2"></i> Login with Google
      </a>
    </li>
    <li id="profile-nav" style="display: none;">
      <a href="users-profile.html" class="flex items-center p-2 text-gray-700 hover:bg-gray-200 rounded" data-translate="profile">
        <i class="fas fa-user-circle mr-2"></i> Profile
      </a>
    </li>
    <li>
      <select id="lang-select" class="w-full p-2 border rounded">
        <option value="ro-RO">Română</option>
        <option value="en-US">English</option>
        <option value="ru-RU">Русский</option>
        <option value="es-ES">Español</option>
        <option value="fr-FR">Français</option>
      </select>
    </li>
    <li class="mt-4">
      <h3 class="text-md font-semibold">Dialogs</h3>
      <div id="dialog-menu" class="space-y-1"></div>
    </li>
  </ul>
</aside>
<main id="main">
  <div id="chat-container">
    <div id="chat-box"></div>
    <div id="input-area">
      <input type="text" id="user-input" placeholder="Type a message...">
      <button id="send-btn" data-translate="send">Send</button>
    </div>
  </div>
</main>
<input type="file" id="file-input" accept="image/*,.pdf,.docx,.txt" style="display: none;">
<script>
  (function() {
    const chatBox = document.getElementById('chat-box');
    const userInput = document.getElementById('user-input');
    const sendBtn = document.getElementById('send-btn');
    const sidebar = document.getElementById('sidebar');
    const toggleSidebarBtn = document.getElementById('toggle-sidebar-btn');
    const langSelect = document.getElementById('lang-select');
    const loginNav = document.getElementById('login-nav');
    const profileNav = document.getElementById('profile-nav');
    const profileBtn = document.getElementById('profile-btn');
    const userName = document.getElementById('user-name');
    const dialogMenu = document.getElementById('dialog-menu');
    const fileInput = document.getElementById('file-input');
    let userData = JSON.parse(localStorage.getItem('userData')) || {};
    let currentUser = localStorage.getItem('currentUser');
    let currentDialog = localStorage.getItem('currentDialog') || 'default';
    let chatHistory = userData[currentUser]?.chats?.[currentDialog] || [];
    let accessToken = localStorage.getItem('googleAccessToken');

    // Split API keys
    const CLIENT_ID_PART1 = '906465572275';
    const CLIENT_ID_PART2 = '-hanrq89dvi0a8bpf2benqdq7quu3njtc';
    const CLIENT_ID = CLIENT_ID_PART1 + CLIENT_ID_PART2 + '.apps.googleusercontent.com';
    const API_KEY_PART1 = 'AIzaSyAlh';
    const API_KEY_PART2 = 'ppnqppicbPMfMz8R5H';
    const API_KEY_PART3 = 'ug3k9i1OTeWw';
    const API_KEY = API_KEY_PART1 + API_KEY_PART2 + API_KEY_PART3;
    const XAI_API_KEY_PART1 = 'xai-cvFdnRUdc4nScFMSg7AMh';
    const XAI_API_KEY_PART2 = 'mmODsOVzpCgPGP1xT9AZA8R';
    const XAI_API_KEY_PART3 = 'LNMDjRVkuTYuzrhMoC6tChxA7WWnNvXT4RJ4';
    const XAI_API_KEY = XAI_API_KEY_PART1 + XAI_API_KEY_PART2 + XAI_API_KEY_PART3;
    const SCOPES = 'https://www.googleapis.com/auth/gmail.readonly https://www.googleapis.com/auth/calendar';

    function saveUserData() {
      localStorage.setItem('userData', JSON.stringify(userData));
      localStorage.setItem('currentDialog', currentDialog);
    }

    function initGoogleClient() {
      gapi.load('client:auth2', () => {
        gapi.client.init({
          apiKey: API_KEY,
          clientId: CLIENT_ID,
          scope: SCOPES,
          discoveryDocs: [
            'https://www.googleapis.com/discovery/v1/apis/gmail/v1/rest',
            'https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest'
          ]
        }).then(() => {
          const authInstance = gapi.auth2.getAuthInstance();
          authInstance.isSignedIn.listen(updateSigninStatus);
          updateSigninStatus(authInstance.isSignedIn.get());
          document.getElementById('google-login-btn').addEventListener('click', () => authInstance.signIn());
        }, (error) => console.error('Error initializing Google client:', error));
      });
    }

    function updateSigninStatus(isSignedIn) {
      if (isSignedIn) {
        const user = gapi.auth2.getAuthInstance().currentUser.get();
        accessToken = user.getAuthResponse().access_token;
        localStorage.setItem('googleAccessToken', accessToken);
        currentUser = user.getBasicProfile().getEmail();
        userData[currentUser] = userData[currentUser] || { chats: { default: [] }, profile: {} };
        userData[currentUser].profile = {
          name: user.getBasicProfile().getName(),
          email: currentUser,
          picture: user.getBasicProfile().getImageUrl()
        };
        localStorage.setItem('currentUser', currentUser);
        saveUserData();
        loginNav.style.display = 'none';
        profileNav.style.display = 'block';
        userName.textContent = userData[currentUser].profile.name || currentUser;
        loadProfile();
      } else {
        loginNav.style.display = 'block';
        profileNav.style.display = 'none';
        userName.textContent = 'Guest';
      }
    }

    function loadProfile() {
      chatHistory = userData[currentUser]?.chats?.[currentDialog] || [];
      renderChatHistory();
      updateDialogMenu();
    }

    function addMessage(text, type, isImage = false, imageUrl = null) {
      const div = document.createElement('div');
      div.className = `message ${type}`;
      if (isImage && imageUrl) {
        const img = document.createElement('img');
        img.src = imageUrl;
        img.style.maxWidth = '100%';
        img.style.borderRadius = '10px';
        div.appendChild(img);
      } else {
        div.innerHTML = marked.parse(text);
      }
      chatBox.appendChild(div);
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    function renderChatHistory() {
      chatBox.innerHTML = '';
      chatHistory.forEach(chat => {
        if (chat.imageUrl) {
          addMessage(chat.text, chat.type, true, chat.imageUrl);
        } else {
          addMessage(chat.text, chat.type);
        }
      });
    }

    async function sendMessageToAI(message, options = {}) {
      const location = userData[currentUser]?.location || { latitude: null, longitude: null };
      const systemPrompt = `Ești Grok 3, creat de xAI. Ai memorie (conversații anterioare), analiză profiluri X/postări/linkuri, procesare imagini, generare imagini, procesare documente (PDF, DOCX, TXT), generare documente, căutare web/X, DeepSearch, Think mode (activează cu buton), și voce (doar app). Răspunde în limba selectată. Include linkuri Google Maps (https://maps.google.com/?q=lat,lng) dacă relevant.`;
      const requestBody = {
        model: 'grok-3',
        messages: [
          { role: 'system', content: systemPrompt },
          { role: 'user', content: `${message}\nLocație: Lat ${location.latitude || 'N/A'}, Long ${location.longitude || 'N/A'}` }
        ],
        stream: false,
        temperature: 0.7,
        ...options
      };
      const response = await fetch('https://api.x.ai/v1/chat/completions', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${XAI_API_KEY}` },
        body: JSON.stringify(requestBody)
      });
      const data = await response.json();
      return data.choices[0].message.content || 'No response';
    }

    sendBtn.addEventListener('click', async () => {
      const message = userInput.value.trim();
      if (!message) return;
      addMessage(message, 'user');
      userInput.value = '';
      const aiResponse = await sendMessageToAI(message);
      addMessage(aiResponse, 'ai');
      chatHistory.push({ type: 'user', text: message }, { type: 'ai', text: aiResponse });
      saveUserData();
    });

    toggleSidebarBtn.addEventListener('click', () => {
      sidebar.classList.toggle('active');
    });

    const translations = {
      'ro-RO': { dashboard: 'Tablou de bord', 'document-editor': 'Editor de documente', 'login-with-google': 'Conectare cu Google', profile: 'Profil', send: 'Trimite' },
      'en-US': { dashboard: 'Dashboard', 'document-editor': 'Document Editor', 'login-with-google': 'Login with Google', profile: 'Profile', send: 'Send' },
      'ru-RU': { dashboard: 'Панель управления', 'document-editor': 'Редактор документов', 'login-with-google': 'Вход через Google', profile: 'Профиль', send: 'Отправить' },
      'es-ES': { dashboard: 'Tablero', 'document-editor': 'Editor de documentos', 'login-with-google': 'Iniciar sesión con Google', profile: 'Perfil', send: 'Enviar' },
      'fr-FR': { dashboard: 'Tableau de bord', 'document-editor': 'Éditeur de documents', 'login-with-google': 'Connexion avec Google', profile: 'Profil', send: 'Envoyer' }
    };

    function translatePage(lang) {
      document.querySelectorAll('[data-translate]').forEach(el => {
        const key = el.getAttribute('data-translate');
        el.textContent = translations[lang][key] || el.textContent;
      });
      userInput.placeholder = `Type a message in ${lang === 'ro-RO' ? 'Română' : lang === 'en-US' ? 'English' : lang === 'ru-RU' ? 'Русский' : lang === 'es-ES' ? 'Español' : 'Français'}...`;
      if (chatHistory.length) renderChatHistory();
    }

    langSelect.addEventListener('change', (e) => {
      const lang = e.target.value;
      translatePage(lang);
      localStorage.setItem('lang', lang);
    });

    function updateDialogMenu() {
      dialogMenu.innerHTML = '';
      const dialogs = Object.keys(userData[currentUser]?.chats || { default: [] });
      dialogs.forEach(dialog => {
        const div = document.createElement('div');
        div.className = 'dialog-item';
        div.textContent = dialog;
        if (dialog === currentDialog) div.classList.add('bg-blue-100');
        div.addEventListener('click', () => {
          currentDialog = dialog;
          chatHistory = userData[currentUser].chats[currentDialog] || [];
          renderChatHistory();
          updateDialogMenu();
          saveUserData();
        });
        dialogMenu.appendChild(div);
      });
      const newDialogBtn = document.createElement('div');
      newDialogBtn.className = 'dialog-item';
      newDialogBtn.textContent = 'New Dialog';
      newDialogBtn.addEventListener('click', () => {
        const newDialog = `dialog_${Date.now()}`;
        userData[currentUser].chats[newDialog] = [];
        currentDialog = newDialog;
        chatHistory = [];
        renderChatHistory();
        updateDialogMenu();
        saveUserData();
      });
      dialogMenu.appendChild(newDialogBtn);
    }

    document.addEventListener('DOMContentLoaded', () => {
      const savedLang = localStorage.getItem('lang') || 'ro-RO';
      langSelect.value = savedLang;
      translatePage(savedLang);
      initGoogleClient();
      if (currentUser) updateSigninStatus(true);
      updateDialogMenu();
      if (!userData[currentUser]?.chats) userData[currentUser].chats = { default: [] };
      if (!userData[currentUser]?.chats[currentDialog]) userData[currentUser].chats[currentDialog] = [];
      renderChatHistory();
    });

    // Image Generation and Processing
    userInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && !e.shiftKey) sendBtn.click();
      if (e.ctrlKey && e.key === 'g') { // Image Generation
        if (confirm('Do you want to generate an image?')) {
          const prompt = prompt('Enter image generation prompt:');
          if (prompt) {
            // Placeholder for xAI image generation API
            // Actual call: fetch('https://api.x.ai/v1/images/generations', { method: 'POST', body: JSON.stringify({ prompt }) })
            addMessage(`Generating image for: ${prompt} (API call placeholder)`, 'ai');
            // Simulated response
            const imageUrl = `https://via.placeholder.com/300?text=${encodeURIComponent(prompt)}`;
            addMessage('', 'ai', true, imageUrl);
            chatHistory.push({ type: 'ai', text: `Image generated for: ${prompt}`, imageUrl });
            saveUserData();
          }
        }
      }
      if (e.ctrlKey && e.key === 'i') { // Image Processing
        fileInput.click();
      }
    });

    fileInput.addEventListener('change', async (e) => {
      const file = e.target.files[0];
      if (file) {
        let content = '';
        if (file.type.startsWith('image/')) {
          const reader = new FileReader();
          reader.onload = (event) => {
            const imageUrl = event.target.result;
            addMessage('', 'user', true, imageUrl);
            // Placeholder for xAI image processing API
            // Actual call: fetch('https://api.x.ai/v1/images/process', { method: 'POST', body: JSON.stringify({ image: imageUrl }) })
            sendMessageToAI(`Analizează această imagine: ${imageUrl}`).then(response => {
              addMessage(response, 'ai');
              chatHistory.push({ type: 'user', text: 'Image uploaded', imageUrl }, { type: 'ai', text: response });
              saveUserData();
            });
          };
          reader.readAsDataURL(file);
        } else if (file.type === 'application/pdf') {
          const arrayBuffer = await file.arrayBuffer();
          const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
          for (let i = 1; i <= pdf.numPages; i++) {
            const page = await pdf.getPage(i);
            const textContent = await page.getTextContent();
            content += textContent.items.map(item => item.str).join(' ') + '\n';
          }
        } else if (file.type === 'application/vnd.openxmlformats-officedocument.wordprocessingml.document') {
          const arrayBuffer = await file.arrayBuffer();
          const { value } = await mammoth.extractRawText({ arrayBuffer });
          content = value;
        } else if (file.type === 'text/plain') {
          content = await file.text();
        }
        if (content) {
          addMessage(`Procesare document: ${file.name}\n${content.substring(0, 200)}${content.length > 200 ? '...' : ''}`, 'user');
          const response = await sendMessageToAI(`Analizează acest document: ${content}`);
          addMessage(response, 'ai');
          chatHistory.push({ type: 'user', text: `Document: ${file.name}`, content }, { type: 'ai', text: response });
          saveUserData();
        }
        fileInput.value = '';
      }
    });

    // Document Generation
    userInput.addEventListener('keydown', (e) => {
      if (e.ctrlKey && e.key === 'd') { // Document Generation
        const prompt = prompt('Enter document generation prompt (e.g., "Create a contract"):');
        if (prompt) {
          sendMessageToAI(`Generează un document: ${prompt}`).then(response => {
            const doc = new docx.Document();
            doc.addSection({
              properties: {},
              children: [new docx.Paragraph(response)]
            });
            docx.Packer.toBlob(doc).then(blob => {
              const url = window.URL.createObjectURL(blob);
              const a = document.createElement('a');
              a.href = url;
              a.download = `document_${Date.now()}.docx`;
              a.click();
              addMessage(`Document generat: <a href="${url}" download>Descarcă aici</a>`, 'ai');
              chatHistory.push({ type: 'ai', text: `Document generated for: ${prompt}`, url });
              saveUserData();
            });
          });
        }
      }
    });
  })();
</script>
</body>
</html>